<?xml version="1.0" encoding="utf-8"?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="R3Ext.SampleApp.DDRefreshPage"
             Title="Refresh and AutoRefresh">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="16">
            <Label Text="DynamicData Refresh Operators"
                   Style="{StaticResource Headline}" />
            <Label Text="Demonstrates AutoRefresh and manual Refresh with reactive property changes."
                   TextColor="Gray" />

            <!-- Input Controls -->
            <Frame BorderColor="LightBlue" Padding="12">
                <VerticalStackLayout Spacing="8">
                    <Label Text="Add Tasks" FontAttributes="Bold" />
                    <Grid ColumnDefinitions="*,Auto" ColumnSpacing="8">
                        <Entry x:Name="TaskEntry" Placeholder="Task name" />
                        <Button Text="Add" Grid.Column="1" Clicked="OnAddTask" />
                    </Grid>
                    <Button Text="Add 3 Sample Tasks" Clicked="OnAddSampleTasks" />
                </VerticalStackLayout>
            </Frame>

            <!-- AutoRefresh Demo -->
            <Label Text="AutoRefresh with Filter (Active Tasks):" FontAttributes="Bold" />
            <Label Text="List auto-updates when task completion status changes" FontSize="12" TextColor="Gray" />
            <Frame BorderColor="Green" Padding="8">
                <VerticalStackLayout Spacing="4">
                    <Label x:Name="ActiveCountLabel" Text="Active: 0" FontAttributes="Bold" />
                    <CollectionView x:Name="ActiveTasksView" MaximumHeightRequest="200">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8" ColumnDefinitions="Auto,*,Auto" ColumnSpacing="8">
                                    <CheckBox IsChecked="{Binding IsCompleted}" CheckedChanged="OnTaskCheckedChanged" />
                                    <Label Text="{Binding Name}" Grid.Column="1" VerticalOptions="Center"
                                           TextDecorations="{Binding IsCompleted, Converter={StaticResource BoolToStrikethroughConverter}}" />
                                    <Label Text="{Binding UpdateCount, StringFormat='({0})'}" Grid.Column="2" TextColor="Gray" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Completed Tasks -->
            <Label Text="Completed Tasks:" FontAttributes="Bold" />
            <Frame BorderColor="Gray" Padding="8">
                <VerticalStackLayout Spacing="4">
                    <Label x:Name="CompletedCountLabel" Text="Completed: 0" FontAttributes="Bold" />
                    <CollectionView x:Name="CompletedTasksView" MaximumHeightRequest="150">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Grid Padding="8" ColumnDefinitions="*,Auto" ColumnSpacing="8">
                                    <Label Text="{Binding Name}" TextDecorations="Strikethrough" TextColor="Gray" />
                                    <Label Text="âœ“" Grid.Column="1" TextColor="Green" FontSize="18" />
                                </Grid>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </VerticalStackLayout>
            </Frame>

            <!-- Controls -->
            <Grid ColumnDefinitions="*,*" ColumnSpacing="8">
                <Button Text="Complete All" Clicked="OnCompleteAll" />
                <Button Text="Clear All" Grid.Column="1" BackgroundColor="DarkRed" Clicked="OnClearAll" />
            </Grid>
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>
